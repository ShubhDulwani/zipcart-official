<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - ZIPCART</title>
    <link rel="stylesheet" href="../css/checkout.css">
</head>
<body>
    <div class="container">
        <header>
            <h1 class="logo"><a href="../index.html">ZIPCART</a></h1>
            
            <nav>
                <a href="products.html">PRODUCTS</a>
                <a href="cart.html">CART</a>
                <a href="checkout.html">CHECKOUT</a>
                <a href="aboutus.html">ABOUT US</a>
            </nav>
            
            <button class="btn-signing">SIGN IN</button>
        </header>

        <main>
            <h1 class="page-title loading">Checkout</h1>
            
            <div class="checkout-container">
                <div class="checkout-form loading">
                    <h2 class="section-title">Billing Information</h2>
                    
                    <form id="checkoutForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName">First Name</label>
                                <input type="text" id="firstName" name="firstName" placeholder="Enter your first name" required>
                            </div>
                            <div class="form-group">
                                <label for="lastName">Last Name</label>
                                <input type="text" id="lastName" name="lastName" placeholder="Enter your last name" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" name="email" placeholder="Enter your email address" required>
                        </div>

                        <div class="form-group">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required>
                        </div>

                        <div class="form-group">
                            <label for="address">Street Address</label>
                            <input type="text" id="address" name="address" placeholder="Enter your street address" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="city">City</label>
                                <input type="text" id="city" name="city" placeholder="Enter your city" required>
                            </div>
                            <div class="form-group">
                                <label for="state">State</label>
                                <select id="state" name="state" required>
                                    <option value="">Select State</option>
                                    <option value="UP">Uttar Pradesh</option>
                                    <option value="MH">Maharashtra</option>
                                    <option value="DL">Delhi</option>
                                    <option value="KA">Karnataka</option>
                                    <option value="TN">Tamil Nadu</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="pincode">PIN Code</label>
                                <input type="text" id="pincode" name="pincode" placeholder="Enter PIN code" required>
                            </div>
                            <div class="form-group">
                                <label for="country">Country</label>
                                <select id="country" name="country" required>
                                    <option value="IN">India</option>
                                    <option value="US">United States</option>
                                    <option value="UK">United Kingdom</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>

                        <h2 class="section-title" style="margin-top: 40px;">Payment Method</h2>
                        
                        <div class="payment-methods">
                            <label class="payment-method">
                                <input type="radio" name="payment" value="card" checked>
                                <span class="payment-icon">üí≥</span>
                                <span>Credit Card</span>
                            </label>
                            <label class="payment-method">
                                <input type="radio" name="payment" value="upi">
                                <span class="payment-icon">üì±</span>
                                <span>UPI</span>
                            </label>
                            <label class="payment-method">
                                <input type="radio" name="payment" value="wallet">
                                <span class="payment-icon">üëõ</span>
                                <span>Wallet</span>
                            </label>
                            <label class="payment-method">
                                <input type="radio" name="payment" value="cod">
                                <span class="payment-icon">üí∏</span>
                                <span>Cash on Delivery</span>
                            </label>
                        </div>

                        <div id="cardDetails" class="form-group" style="margin-top: 30px;">
                            <div class="form-group">
                                <label for="cardNumber">Card Number</label>
                                <input type="text" id="cardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expiryDate">Expiry Date</label>
                                    <input type="text" id="expiryDate" name="expiryDate" placeholder="MM/YY" maxlength="5">
                                </div>
                                <div class="form-group">
                                    <label for="cvv">CVV</label>
                                    <input type="text" id="cvv" name="cvv" placeholder="123" maxlength="3">
                                </div>
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 40px;">
                            <button type="button" class="btn-secondary" onclick="goBack()">‚Üê Back to Cart</button>
                            <button type="submit" class="btn-primary">Complete Purchase</button>
                        </div>
                    </form>
                </div>

                <div class="order-summary loading">
                    <h2 class="section-title">Order Summary</h2>
                    
                    <div class="cart-items" id="cartItems">
                        <!-- Cart items will be populated by JavaScript -->
                    </div>

                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">‚Çπ0</span>
                    </div>
                    <div class="summary-row">
                        <span>Shipping:</span>
                        <span id="shipping">‚Çπ99</span>
                    </div>
                    <div class="summary-row">
                        <span>Tax (18%):</span>
                        <span id="tax">‚Çπ0</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="total">‚Çπ0</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="success-icon">‚úÖ</div>
            <h2>Order Placed Successfully!</h2>
            <p>Thank you for your purchase. Your order has been confirmed and will be processed shortly.</p>
            <p><strong>Order ID:</strong> <span id="orderId"></span></p>
            <button class="btn-primary" onclick="closeModal()" style="margin-top: 20px;">Continue Shopping</button>
        </div>
    </div>

    <script>
        // Load cart data from localStorage
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        // Ensure all items have proper structure
        cart = cart.map(item => ({
            ...item,
            price: typeof item.price === 'number' ? item.price : parseFloat(item.price.replace(/[^0-9.-]+/g,""))
        }));

        // Initialize checkout page
        function initCheckout() {
            loadCartItems();
            calculateTotals();
            setupPaymentMethods();
            setupFormValidation();
            setupCardFormatting();
        }

        // Load cart items
        function loadCartItems() {
            const cartItemsContainer = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="empty-cart">
                        <div class="empty-cart-icon">üõí</div>
                        <h3>Your cart is empty</h3>
                        <p>Add some products to checkout</p>
                        <button class="btn-primary" onclick="window.location.href='products.html'" style="margin-top: 20px;">Shop Now</button>
                    </div>
                `;
                return;
            }

            cartItemsContainer.innerHTML = cart.map((item, index) => `
                <div class="cart-item">
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-price">‚Çπ${item.price.toLocaleString()} √ó ${item.quantity}</div>
                    </div>
                    <button class="remove-btn" onclick="removeFromCart(${index})">√ó</button>
                </div>
            `).join('');
        }

        // Remove item from cart
        function removeFromCart(index) {
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCartItems();
            calculateTotals();
        }

        // Calculate totals
        function calculateTotals() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = cart.length > 0 ? (subtotal > 1000 ? 0 : 99) : 0;
            const tax = Math.round(subtotal * 0.18);
            const total = subtotal + shipping + tax;

            document.getElementById('subtotal').textContent = `‚Çπ${subtotal.toLocaleString()}`;
            document.getElementById('shipping').textContent = shipping === 0 ? 'Free' : `‚Çπ${shipping}`;
            document.getElementById('tax').textContent = `‚Çπ${tax.toLocaleString()}`;
            document.getElementById('total').textContent = `‚Çπ${total.toLocaleString()}`;
        }

        // Setup payment methods
        function setupPaymentMethods() {
            const paymentMethods = document.querySelectorAll('.payment-method');
            const cardDetails = document.getElementById('cardDetails');

            paymentMethods.forEach(method => {
                method.addEventListener('click', () => {
                    // Remove selected class from all methods
                    paymentMethods.forEach(m => m.classList.remove('selected'));
                    
                    // Add selected class to clicked method
                    method.classList.add('selected');
                    
                    // Show/hide card details
                    const paymentValue = method.querySelector('input').value;
                    cardDetails.style.display = paymentValue === 'card' ? 'block' : 'none';
                });
            });

            // Set initial state
            paymentMethods[0].classList.add('selected');
        }

        // Setup form validation
        function setupFormValidation() {
            const form = document.getElementById('checkoutForm');
            
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                if (cart.length === 0) {
                    alert('Your cart is empty!');
                    return;
                }

                if (validateForm()) {
                    processOrder();
                }
            });
        }

        // Validate form
        function validateForm() {
            const form = document.getElementById('checkoutForm');
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.style.borderColor = '#ff4444';
                    isValid = false;
                } else {
                    field.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                }
            });

            // Validate email
            const email = document.getElementById('email');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email.value)) {
                email.style.borderColor = '#ff4444';
                isValid = false;
            }

            // Validate phone
            const phone = document.getElementById('phone');
            const phoneRegex = /^[0-9]{10}$/;
            if (!phoneRegex.test(phone.value.replace(/\D/g, ''))) {
                phone.style.borderColor = '#ff4444';
                isValid = false;
            }

            // Validate card details if card payment is selected
            const selectedPayment = document.querySelector('input[name="payment"]:checked').value;
            if (selectedPayment === 'card') {
                const cardNumber = document.getElementById('cardNumber');
                const expiryDate = document.getElementById('expiryDate');
                const cvv = document.getElementById('cvv');

                if (cardNumber.value.replace(/\s/g, '').length !== 16) {
                    cardNumber.style.borderColor = '#ff4444';
                    isValid = false;
                }

                if (!/^\d{2}\/\d{2}$/.test(expiryDate.value)) {
                    expiryDate.style.borderColor = '#ff4444';
                    isValid = false;
                }

                if (cvv.value.length !== 3) {
                    cvv.style.borderColor = '#ff4444';
                    isValid = false;
                }
            }

            if (!isValid) {
                alert('Please fill in all required fields correctly.');
            }

            return isValid;
        }

        // Setup card number formatting
        function setupCardFormatting() {
            const cardNumber = document.getElementById('cardNumber');
            const expiryDate = document.getElementById('expiryDate');

            cardNumber.addEventListener('input', (e) => {
                let value = e.target.value.replace(/\s/g, '').replace(/\D/g, '');
                let formattedValue = value.replace(/(.{4})/g, '$1 ').trim();
                e.target.value = formattedValue;
            });

            expiryDate.addEventListener('input', (e) => {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                e.target.value = value;
            });
        }

        // Process order
        function processOrder() {
            const total = document.getElementById('total').textContent;
            
            // Show loading state
            const submitBtn = document.querySelector('button[type="submit"]');
            submitBtn.textContent = 'Processing...';
            submitBtn.disabled = true;
            
            // Simulate order processing
            setTimeout(() => {
                // Generate order ID
                const orderId = 'ZC' + Date.now().toString().slice(-8);
                document.getElementById('orderId').textContent = orderId;
                
                // Show success modal
                document.getElementById('successModal').style.display = 'flex';
                
                // Clear cart after successful order
                localStorage.removeItem('cart');
            }, 2000);
        }

        // Go back to cart
        function goBack() {
            window.location.href = 'cart.html';
        }

        // Close modal and redirect
        function closeModal() {
            document.getElementById('successModal').style.display = 'none';
            window.location.href = '../index.html';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initCheckout);
</script>